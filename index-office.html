<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory Management ‚Äì Seavo Nautiq</title>
  <style>
    body {
      background-color: #12315c;
      font-family: Arial, sans-serif;
      margin: 0;
      color: white;
    }

    .category-slider {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #1e3a5f;
      padding: 10px;
      overflow-x: auto;
    }

    .category-item {
      display: flex;
      align-items: center;
      margin: 0 5px;
    }

    .category-button, .add-category {
      padding: 10px 15px;
      background-color: #2c7edb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .category-button.active {
      background-color: #00b7ff;
      font-weight: bold;
    }

    .delete-category {
      color: rgb(255, 0, 0);
      font-size: 16px;
      margin-left: 5px;
      cursor: pointer;
    }

    .arrow {
      font-size: 20px;
      padding: 5px 10px;
      background-color: #0e2646;
      color: white;
      border: none;
      cursor: pointer;
    }

    #content {
      padding: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      color: black;
      margin-bottom: 15px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #00b7ff;
      color: white;
    }

    td.min-col input {
      width: 60px;
    }

    .red-warning {
      background-color: #cc3333;
    }

    .add-line {
      padding: 8px 16px;
      margin: 5px 10px 20px 0;
      font-size: 15px;
      cursor: pointer;
    }

    .header-row td {
      background: linear-gradient(to left, #12315c, #6e9ad8);
      font-weight: bold;
      text-align: left;
    }

    .header-row td span {
      display: inline-block;
      width: 90%;
    }

    .delete-button {
      color: red;
      cursor: pointer;
      font-size: 18px;
    }

    .global-button {
      background-color: #00b7ff;
      border: none;
      color: white;
      padding: 10px 15px;
      font-size: 14px;
      cursor: pointer;
      margin: 10px 20px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<div class="category-slider">
  <button class="arrow" onclick="scrollSlider(-100)">‚≠•</button>
  <div id="category-container" style="display: flex; overflow-x: auto; max-width: 70%; scroll-behavior: smooth;">
    <div id="categories" style="display: flex; gap: 8px;"></div>
  </div>
  <button class="arrow" onclick="scrollSlider(100)">‚≠ß</button>
  <button class="add-category" onclick="addCategory()">+ Category</button>
</div>

<div id="content"></div>

<button class="global-button" onclick="showGlobalOverview()">üìã Global Overview</button>

<script>
let data = JSON.parse(localStorage.getItem("lagerDataV3")) || {};
let activeCategory = Object.keys(data)[0] || "Standard";

function save() {
  localStorage.setItem("lagerDataV3", JSON.stringify(data));
}

function scrollSlider(offset) {
  document.getElementById("category-container").scrollLeft += offset;
}

function updateCategories() {
  const container = document.getElementById("categories");
  container.innerHTML = "";

  Object.keys(data).forEach(name => {
    const wrapper = document.createElement("div");
    wrapper.className = "category-item";
    wrapper.style.display = "flex";
    wrapper.style.alignItems = "center";

    const btn = document.createElement("button");
    btn.className = "category-button";
    btn.textContent = name;
    if (name === activeCategory) btn.classList.add("active");
    btn.onclick = () => {
      activeCategory = name;
      showCategory();
      updateCategories();
    };

    const del = document.createElement("span");
    del.className = "delete-category";
    del.textContent = "üóëÔ∏è";
    del.onclick = () => {
      if (confirm(`Do you want to delete the category "${name}"?`)) {
        delete data[name];
        activeCategory = Object.keys(data)[0] || null;
        save();
        updateCategories();
        showCategory();
      }
    };

    wrapper.appendChild(btn);
    wrapper.appendChild(del);
    container.appendChild(wrapper);
  });
}

function addCategory() {
  const name = prompt("New category:");
  if (name && !data[name]) {
    data[name] = [];
    activeCategory = name;
    save();
    updateCategories();
    showCategory();
  }
}

function showCategory() {
  const content = document.getElementById("content");
  content.innerHTML = "";

  if (!activeCategory || !data[activeCategory]) return;

  const table = document.createElement("table");
  table.innerHTML = `
    <thead>
      <tr>
        <th>Product/Type</th><th>Start Qty</th><th>Used</th><th>End Qty</th>
        <th>Min Set</th><th>Comments</th><th>Order</th><th>Delete</th>
      </tr>
    </thead>
    <tbody></tbody>
  `;
  const tbody = table.querySelector("tbody");

  data[activeCategory].forEach((row, i) => {
    const tr = document.createElement("tr");

    if (row.type === "header") {
      tr.className = "header-row";
      const td = document.createElement("td");
      td.colSpan = 7;
      const span = document.createElement("span");
      span.contentEditable = true;
      span.textContent = row.text || "Section / Header";
      span.oninput = () => {
        row.text = span.textContent;
        save();
      };
      td.appendChild(span);
      tr.appendChild(td);

      const del = document.createElement("td");
      del.innerHTML = `<span class="delete-button" onclick="deleteRow(${i})">üóëÔ∏è</span>`;
      tr.appendChild(del);
      tbody.appendChild(tr);
      return;
    }

    const fields = ['product', 'start', 'used', 'end', 'min', 'comment', 'order'];
    const inputs = {};

    fields.forEach((key) => {
      const td = document.createElement("td");
      if (key === "min") td.className = "min-col";
      const input = document.createElement("input");
      input.type = key === "product" || key === "comment" ? "text" : "number";
      input.value = row[key] || "";
      input.style.width = "100%";
      input.oninput = () => {
        row[key] = input.value;

        row.end = (parseFloat(row.start) || 0) - (parseFloat(row.used) || 0);
        inputs['end'].value = row.end;

        const endVal = parseFloat(row.end);
        const minVal = parseFloat(row.min);
        if (!isNaN(endVal) && !isNaN(minVal) && endVal <= minVal) {
          inputs['min'].classList.add("red-warning");
        } else {
          inputs['min'].classList.remove("red-warning");
        }

        save();
      };
      inputs[key] = input;
      td.appendChild(input);
      tr.appendChild(td);
    });

    const tdDel = document.createElement("td");
    tdDel.innerHTML = `<span class="delete-button" onclick="deleteRow(${i})">üóëÔ∏è</span>`;
    tr.appendChild(tdDel);

    tbody.appendChild(tr);
  });

  content.appendChild(table);

  const addLine = document.createElement("button");
  addLine.className = "add-line";
  addLine.textContent = "+ Add line";
  addLine.onclick = () => {
    data[activeCategory].push({
      type: "line", product: "", start: 0, used: 0,
      comment: "", min: 0, order: 0, end: 0
    });
    save();
    showCategory();
  };

  const addHeader = document.createElement("button");
  addHeader.className = "add-line";
  addHeader.textContent = "+ Add header/section";
  addHeader.onclick = () => {
    data[activeCategory].push({ type: "header", text: "New Header" });
    save();
    showCategory();
  };

  content.appendChild(addLine);
  content.appendChild(addHeader);
}

function deleteRow(index) {
  data[activeCategory].splice(index, 1);
  save();
  showCategory();
}

function showGlobalOverview() {
  const content = document.getElementById("content");
  content.innerHTML = "<h2>Global overview of the entire inventory</h2>";
  const table = document.createElement("table");
  table.innerHTML = `
    <thead>
      <tr><th>Category</th><th>Product</th><th>Start</th><th>Used</th><th>End</th><th>Min</th><th>Comment</th><th>Order</th></tr>
    </thead>
    <tbody></tbody>
  `;
  const tbody = table.querySelector("tbody");

  Object.entries(data).forEach(([category, rows]) => {
    rows.forEach(row => {
      if (row.type === "header") return;
      const tr = document.createElement("tr");
      const start = parseInt(row.start) || 0;
      const used = parseInt(row.used) || 0;
      const end = row.end ?? (start - used);
      const min = parseInt(row.min) || 0;

      const values = [
        category,
        row.product || "",
        start,
        used,
        end,
        min,
        row.comment || "",
        row.order || ""
      ];

      values.forEach((val, i) => {
        const td = document.createElement("td");
        td.textContent = val;
        if (i === 4 && end <= min) td.classList.add("red-warning");
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });
  });

  content.appendChild(table);
}

if (!data[activeCategory]) {
  data[activeCategory] = [];
  save();
}
updateCategories();
showCategory();
</script>
</body>
</html>
