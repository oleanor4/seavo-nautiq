<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Medicine – Seavo Nautiq</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  <style>
/* ====== THEME / BASE (samme palett som Office) ====== */
:root{
  --bg:#0f2a4a;
  --text:#ffffff;
  --muted:#bcd3f1;
  --accent:#62b2e7;
  --accent-2:#1b75d1;
  --accent-3:#0e3e86;
  --danger:#f03747;
  --warn:#ecc543;
  --ok:#28e755;
}

*{ box-sizing:border-box; }
body{
  background-color:var(--bg);
  font-family:Arial,sans-serif;
  margin:0;
  color:var(--text);
}

/* Header-video */
.video-header{ position:relative; aspect-ratio:1280/99; overflow:hidden; background:#000; }
.video-header video{ width:100%; height:200%; object-fit:cover; display:block; }
.gradient-overgang{ height:10px; background:linear-gradient(to left,#62b2e7,#001125); box-shadow:6px 4px 6px rgba(0,0,0,.7); }

/* Tittel */
h1{
  text-align:center; margin-top:20px; font-size:36px; font-weight:bold;
  text-shadow:0 1px 3px rgba(0,0,0,.6); color:rgb(30,182,209);
}

/* Bakgrunnsbilde (vannmerke) */
.medicine-image{
  width:100%; height:130%; position:absolute; top:0; left:0; z-index:-1; opacity:.08; pointer-events:none;
  filter:saturate(.9) contrast(1.05);
}

/* Panel / kort */
.panel{
  background:rgba(0,0,0,.25);
  padding:16px; margin:20px auto; max-width:1400px; border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 12px 28px rgba(0,0,0,.35);
}
.panel h2{ margin:4px 0 10px; }

/* Tabell (Office-look) */
table{
  width:100%; border-collapse:collapse; background:rgba(0,0,0,.20); color:var(--text);
  border:1px solid rgba(255,255,255,.12); border-radius:14px; overflow:hidden;
  box-shadow:0 12px 28px rgba(0,0,0,.35);
}
th,td{ border-bottom:1px solid rgba(255,255,255,.12); padding:8px; text-align:center; font-size:16px; }
th{ background:rgba(0,0,0,.28); color:var(--text); }


input[type="text"], input[type="number"], input[type="date"]{
  width:95%; padding:10px; border-radius:10px;
  background:rgba(0,0,0,.25); color:var(--text);
  border:1px solid rgba(255,255,255,.18);
  font-weight:700; font-size:14px;
  outline:none;
}

input[type="text"]::placeholder{ color:var(--muted); }
input[type="number"]::placeholder{ color:var(--muted); }
input[type="date"]::placeholder{ color:var(--muted); }
input:focus{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(98,178,231,.18); }

.medical-equipment-input::placeholder{ color:var(--muted); }
.medical-equipment-input:focus{ border-color:var(--accent); box-shadow:0 0 0 3px rgba(98,178,231,.18); }

/* Knapper (Office-gradients) */
.btn{
  padding:10px 16px; border:none; border-radius:12px; cursor:pointer; font-weight:700; font-size:14px;
  background:linear-gradient(to right,var(--accent-2),var(--accent-3));
  color:#fff; border:1px solid rgba(255,255,255,.12); box-shadow:0 6px 16px rgba(0,0,0,.35);
}
.btn:hover{ filter:brightness(1.25); }
.btn-del{
  background:linear-gradient(to right,#f13e4e,#a31621);
}
.btn-pdf{
  background:linear-gradient(to right,#6c757d,#495057);
}

/* MIN-alarm (beholdt) */
.min-alarm{
  background:linear-gradient(to right, rgba(255,255,255,.2), rgba(247,230,0,.35)) !important;
}

/* Expiry "trafikklys" (Office-stil) */
.expiry-green{
  background:linear-gradient(to right,#000000,#39e99f) !important; color:#000; font-weight:bold;
  box-shadow:0 0 6px rgba(0,0,0,.4);
}
.expiry-yellow{
  background:linear-gradient(to right,#000000,#ffda47) !important; color:#000; font-weight:bold;
  box-shadow:0 0 6px rgba(0,0,0,.4);
}
.expiry-red{
  background:linear-gradient(to right,#000000,#d12e2e) !important; color:#000; font-weight:bold;
  box-shadow:0 0 6px rgba(0,0,0,.4);
}

/* Print */
@media print{
  body{ background:#fff; color:#000; }
  .video-header,.gradient-overgang{ display:none !important; }
  table{ background:#fff; color:#000; box-shadow:none; border:1px solid #ccc; }
  th{ background:#f2f2f2; color:#000; }
}
  </style>
</head>
<body>
<header class="video-header">
  <video autoplay muted loop playsinline>
    <source src="Video/Ocean-Seavo-Nautiq.mp4" type="video/mp4">
  </video>
</header>
<div class="gradient-overgang"></div>

<h1>Medicine</h1>

<div><img src="images/Medicine chest.PNG" alt="Medicine" class="medicine-image"></div>

<div id="printArea">
  <div class="panel">
    <h2>Registration</h2>
    <table>
      <tr>
        <td><label>Registration Date<br><input type="date" id="regDate"></label></td>
        <td><label>Expiry Date<br><input type="date" id="regExpiry"></label></td>
        <td><label>Medicine Issuer<br><input type="text" id="issuer" placeholder="Company / Clinic"></label></td>
        <td><label>Responsible Officer<br><input type="text" id="officer" placeholder="Name/Role"></label></td>
        <td><label>Notes<br><input type="text" id="notes" placeholder="Optional notes"></label></td>
      </tr>
    </table>
  </div>

  <div class="panel">
    <h2>Medicine Chest</h2>
    <table id="medicineTable">
      <thead>
        <tr>
          <th>Medical equipment</th>
          <th>Qty</th>
          <th>MIN🔔</th>
          <th>Expiry date</th>
          <th>Comments</th>
          <th>Order</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
      <button class="btn" onclick="addMedicineLine()">+ Add Line</button>
      <button class="btn btn-pdf" onclick="generatePDF()">📄 Generate PDF (B/W)</button>
    </div>
  </div>
</div>

<!-- jsPDF + AutoTable for ren s/h-rapport -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.4/dist/jspdf.plugin.autotable.min.js"></script>

<script>
/* ====== Felles funksjon: sett expiry-klasse med 50/20-dagers terskel ====== */
function applyExpiryClass(el){
  el.classList.remove("expiry-green","expiry-yellow","expiry-red");
  if(!el.value) return;

  const today = new Date(); today.setHours(0,0,0,0);
  const exp   = new Date(el.value); exp.setHours(0,0,0,0);
  const diffDays = Math.ceil((exp - today) / (1000*60*60*24));

  // Rød: <= 20 dager (også passert), Gul: <= 50 dager, Grønn: ellers
  if(diffDays <= 20){ el.classList.add("expiry-red"); }
  else if(diffDays <= 50){ el.classList.add("expiry-yellow"); }
  else { el.classList.add("expiry-green"); }
}

/* ====== Init for registreringens Expiry ====== */
(function initRegistrationExpiry(){
  const regExpiry = document.getElementById("regExpiry");
  if(!regExpiry) return;
  const handler = ()=> applyExpiryClass(regExpiry);
  regExpiry.addEventListener("input", handler);
  // Kjør en gang ved last
  handler();
})();

/* ====== Legg til linje i tabell (uendret logikk, men med ny style + expiry-alarm) ====== */
function addMedicineLine(){
  const tbody = document.querySelector("#medicineTable tbody");
  const tr = document.createElement("tr");

  const tdEquip = document.createElement("td");
  const equip = document.createElement("input");
  equip.type = "text"; equip.placeholder="Med Eq";
  tdEquip.appendChild(equip);

  const tdQty = document.createElement("td");
  const qty = document.createElement("input");
  qty.type="number"; qty.value=0;
  tdQty.appendChild(qty);

  const tdMin = document.createElement("td");
  const min = document.createElement("input");
  min.type="number"; min.value=0;
  tdMin.appendChild(min);

  const tdExp = document.createElement("td");
  const exp = document.createElement("input");
  exp.type="date";
  tdExp.appendChild(exp);

  const tdCom = document.createElement("td");
  const com = document.createElement("input");
  com.type="text"; com.placeholder="Comments";
  tdCom.appendChild(com);

  const tdOrder = document.createElement("td");
  const order = document.createElement("input");
  order.type="number"; order.value=0;
  tdOrder.appendChild(order);

  const tdDel = document.createElement("td");
  const delBtn = document.createElement("button");
  delBtn.textContent="🗑️";
  delBtn.className="btn btn-del";
  delBtn.onclick=()=> tr.remove();
  tdDel.appendChild(delBtn);

  tr.append(tdEquip, tdQty, tdMin, tdExp, tdCom, tdOrder, tdDel);
  tbody.appendChild(tr);

  // --- alarm checks (UI) ---
  function checkAlarms(){
    const q = parseFloat(qty.value)||0;
    const m = parseFloat(min.value)||0;
    if(q <= m){ min.classList.add("min-alarm"); } else { min.classList.remove("min-alarm"); }

    applyExpiryClass(exp); // bruker samme 50/20 terskler
  }

  qty.oninput=checkAlarms;
  min.oninput=checkAlarms;
  exp.oninput=checkAlarms;

  // Kjør ved opprettelse
  checkAlarms();
}

/* ---- PDF (svart/hvitt) med jsPDF AutoTable ---- */
async function generatePDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });
  const left = 40;

  doc.setFont('helvetica','bold'); doc.setFontSize(16);
  doc.text('Seavo Nautiq — Medicine Register', left, 50);

  doc.setFont('helvetica','normal'); doc.setFontSize(11);
  let y = 75;
  const reg = {
    'Registration Date': document.getElementById('regDate').value || '—',
    'Expiry Date': document.getElementById('regExpiry').value || '—',
    'Medicine Issuer': document.getElementById('issuer').value || '—',
    'Responsible Officer': document.getElementById('officer').value || '—',
    'Notes': document.getElementById('notes').value || '—'
  };
  Object.entries(reg).forEach(([k,v]) => { doc.text(`${k}: ${v}`, left, y); y += 16; });

  const rows = [];
  document.querySelectorAll('#medicineTable tbody tr').forEach(tr => {
    const tds = tr.querySelectorAll('td');
    const getVal = (tdIndex) => (tds[tdIndex]?.querySelector('input')?.value || '').trim();
    rows.push([ getVal(0), getVal(1), getVal(2), getVal(3), getVal(4), getVal(5) ]);
  });

  doc.autoTable({
    startY: y + 6,
    head: [['Medical equipment','Qty','MIN','Expiry date','Comments','Order']],
    body: rows.length ? rows : [['—','—','—','—','—','—']],
    styles: { font: 'helvetica', fontSize: 10, textColor: [0,0,0], lineColor: [0,0,0], lineWidth: 0.5 },
    headStyles: { fillColor: [255,255,255], textColor: [0,0,0] },
    alternateRowStyles: { fillColor: [245,245,245] },
    margin: { left, right: left }
  });

  const pageCount = doc.getNumberOfPages();
  for(let i=1;i<=pageCount;i++){
    doc.setPage(i);
    doc.setFontSize(9);
    doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.getWidth()-left, doc.internal.pageSize.getHeight()-20, { align: 'right' });
  }

  doc.save('Medicine_Register.pdf');
}
</script>
</body>
</html>