<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parts and tools – Seavo Nautiq</title>
  <style>
    body {
      background-color: #12315c;
      font-family: Arial, sans-serif;
      margin: 0;
      color: rgb(255, 255, 255);
    }

    
  .video-header {
  position: relative;
  aspect-ratio: 1280 / 99; /* behold riktig proporsjon */
  overflow: hidden;
  background-color: #000; /* fallback bakgrunn */
}


.video-header video {
  width: 100%;
  height: 200%;
  object-fit: cover;
  display: block;
}

.gradient-overgang {
  height: 10px;
  background: linear-gradient(to left, #62b2e7, #001125);
  box-shadow: 6px 4px 6px rgba(0, 0, 0, 0.7);
}

    .category-slider-parts {
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(to right, #041425, #3b7fbe);
      padding: 18px;
      overflow-x: auto;
      margin-bottom: 10px;
      margin-top: 30px;
      width: 90%;
      margin-left: 80px;
      border-radius: 18px;
    }

    .category-item {
      display: flex;
      align-items: center;
      margin: 0 6px;
    }

    .category-button, .add-category {
      padding: 8px 30px;
      background: linear-gradient(to right, #00b7ff, #326fa8);
      color: rgb(255, 255, 255);
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;  
    }

    .category-button.active {
      background: #9ccdfa;
      font-weight: bold;
    }
    
    .category-button:hover, .add-category:hover {
      background: #56bafd;
      color: white;
    }

    .delete-category {
      color: rgb(255, 0, 0);
      font-size:20px;
      margin-left: 20px;
      margin-right: 40px;
      cursor: pointer;
    }

    .delete-category:hover {
     background-color: rgba(0, 0, 0, 0.3); 
      border-radius: 50px; 
      padding:0px 4px;
    }

    .arrow {
      font-size: 20px;
      font-weight: bold;
      padding: 5px 10px;
      background: transparent;
      color: rgb(255, 255, 255);
      border-radius: 6px;
      cursor: pointer;
      width: 60px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
    }

    .arrow:hover {
      background: #36a7f1;
      color: white;
    }

    #content {
      padding: 60px;
    }

    .logo {
     width: 200px;
     height: auto;
     border-radius: 6px;
     box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
     cursor: pointer;
     float: left;
     margin-left: 60px;
     margin-top: -40px;
   }

.logo:hover {
  transform: scale(1.08);
  transition: transform 0.2s ease;
  box-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
}


    #searchBox {
      width: 200px;
      padding: 10px;
      border-radius: 6px;
      border:  1px solid #000000;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
      margin-left: 60px;
      margin-top: 60px;
      margin-bottom:  10px;
      font-weight: bold;
    }

    .highlight {
  background-color: rgb(240, 138, 42);
  font-weight: bold;
}

.highlight-input {
  background-color: yellow;
  font-weight: bold;
}

    .parts-and-tools {
       width: 100%;
     height: 140%;
     position: absolute;
     top: 0;
     left: 0;
     z-index: -1;
     opacity: 0.1;
     pointer-events: none;
    }


    table { 
      width: 100%;
      border-collapse: collapse;
      background-color: rgb(31, 59, 102);
      color: rgb(0, 0, 0);
      margin-bottom: 20px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.6);
    }


    .large-bold-input {
      font-weight: bold;
      font-size: 14px;
    }

    .cell-min {
      width: 80px;
    }

    .cell-order {
      width: 100px;
    }

    .cell-move {
      width: 110px;
      button {
        width: 40px;
        height: 35px;
        background: linear-gradient(to right, #00b7ff, #326fa8);
        color: rgb(255, 255, 255);
        border-radius: 6px;
        cursor: pointer;
        font-size: 18px;
      }
      button:hover {
        background: #87cfff;
        color: white;
      }
    }


    th, td {
      border: 1px solid #112036;
      padding: 5px;
      text-align: center;
      font-size: 18px;
    }

    th {
      background-color:  #14a8ec;
      color: rgb(0, 0, 0);
      border-radius: 5px;
    }

    td.min-col input {
      width: 60px;
    }

    .red-warning {
      background: linear-gradient(to right, #ffffff, #fcac01);
    }

    .add-line {
      padding: 8px 16px;
      margin: 5px 10px 20px 0;
      font-size: 15px;
      font-weight: bold;
      border-radius: 10px;
      background: linear-gradient(to right, #00b7ff, #326fa8);
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
    }
    .add-line:hover {
      background: #6eaed8;
      color: white;
    }

    .color-btn.limegreen { background-color: #36d131; }   
    .color-btn.gold { background-color: #ffd036; }  
    .color-btn.mediumturquoise { background-color: #40e0d0; }
    .color-btn.white { background-color: #ffffff; }

    .color-btn {
      width: 18px;      
      height: 10px;
      border-radius: 30%;
      cursor: pointer;
    }

    .color-btn:hover {
      outline: 1px solid #fff;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.6);
    }


    .color-buttons {
      display: inline-flex;
      flex-direction: column;
      gap: 1px;
      margin-left: 2px;
      vertical-align: middle;
      transform: translateY( 0px); 
    }


    .header-row td {
      background: linear-gradient(to left, #12315c, #79acee);
      font-weight: bold;;
      text-align: left;
      border-radius: 5px;
      border-color: black;
    }

    .header-row td span {
      display: inline-block;
      width: 60%;
    }

    .delete-button {
      color: rgb(0, 0, 0);
      cursor: pointer;
      font-size: 20px;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);
    }

    .delete-button:hover {
      background-color: rgba(0, 0, 0, 0.3); 
      border-radius: 50px; 
      padding:0px 4px;
    }

    td:last-child {
      width: 50px; 
      background: linear-gradient(to right, #4e9bce, #1b3863);
    }


      button img {
      width: 40px;
      height: 40px;
      padding-left: 55px;
      margin-top: 20px;
    }


    .global-button {
      background: linear-gradient(to right, #00b7ff, #326fa8);
      color: rgb(255, 255, 255);
      padding: 20px 15px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 60px;
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
    }

    .global-button:hover {
      background: #1077bb;
      color: white;
    }

    
  td input[type="file"] {
  width: 80%;
  padding: 2px;
}

.image-upload-container {
  display: flex;
  align-items: center;
  gap: 20px; 
  justify-content: center; 
}

.image-upload-container img {
  max-width: 50px;
  max-height: 50px;
  border-radius: 6px;
  box-shadow: 0 0 5px rgba(0,0,0,0.4);
  inline-size: 20%;
}



.upload-btn {
  background: linear-gradient(to right, #00b7ff, #326fa8);
  color: white;
  border-radius: 6px;
  padding: 4px 6px;
  font-size: 14px;
  cursor: pointer;
  font-weight: bold;
  box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
  
  position: block;
}

.upload-btn:hover {
  background: #56bafd;
}


    .cell-product {
      width: 380px;
    }

    .cell-comment {
     width: 350px;
   }



   .cell-small {
   width:130px;
   }

  #image-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

#modal-overlay {
  position: absolute;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  cursor: pointer;
}

#modal-image {
  max-width: 90%;
  max-height: 90%;
  z-index: 1001;
  border-radius: 8px;
  box-shadow: 0 0 15px rgba(0,0,0,0.8);
}

  
#sidePanel {
  position: fixed;
  top: 0;
  right: 0;
  width: 180px;
  height: 32%;
  background: linear-gradient(to left, #072446, #306cc7);
  color: rgb(0, 0, 0);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px 10px;
  box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);
  transition: right 0.5s ease;
  z-index: 999;
  border-radius: 16px;
  border: 2px solid #3994e9;
}

#sidePanel.hidden {
  right: -160px;
}

#sidePanel button {
  margin: 4px 0;
  padding: 12px 20px;
  width: 100%;
  background: linear-gradient(to right, #123981, #1994db);
  color: rgb(0, 0, 0);
  font-weight: bold;

  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
}

#sidePanel button:hover {
  background: #56bafd;
}

#signOutBtn {
  margin-top: 40px;
}

#bottomButtons {
  margin-top: auto;
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

#togglePanelBtn {
  position: fixed;
  top: 10%;
  right: 150px;
  transform: translateY(-50%);
  background: #16a5f8;
  color: rgb(255, 255, 255);
  border-radius: 0 10px 10px 0;
  padding: 6px;
  cursor: pointer;
  font-weight: bold;
  font-size: 35px;
  z-index: 1000;
  box-shadow: -2px 0 8px rgba(0, 0, 0, 0.3);
}

#togglePanelBtn:hover {
  background: #064b79;
}


@media (max-width: 768px) {
  table, thead, tbody, th, td, tr {
    display: block;
  }
}

/* ========================= */
/* D/W/V (Fuel/Lube/Ballast) */
/* ========================= */

#dvwSection {
  margin: 20px 60px 60px 60px;
}

#dvwSection h2 {
  margin: 10px 0 14px 0;
  font-size: 22px;
  font-weight: bold;
  color: #e8f2ff;
  text-shadow: 0 1px 3px rgba(0,0,0,.35);
}

.dvw-table {
  background-color: rgb(31, 59, 102);
}

.dvw-table th {
  background-color: #14a8ec;
  color: #000;
}

.dvw-table input[type="text"],
.dvw-table input[type="number"]{
  width: 95%;
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #112036;
  font-weight: bold;
}


/* Level gauge */
.level-wrap{
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:center;
}

.level-input-row{
  display:flex;
  align-items:center;
  gap:8px;
  width:100%;
  justify-content:center;
}

.level-input-row input{
  width: 60%;
}

.level-bar{
  width:95%;
  height:16px;
  border-radius:10px;
  background: rgba(255,255,255,.15);
  border:1px solid rgba(0,0,0,.35);
  overflow:hidden;
  position:relative;
  box-shadow: inset 0 0 6px rgba(0,0,0,.45);
}

.level-fill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, #f03747, #ffd036, #36d131);
  transition: width .25s ease;
}

.level-label{
  position:absolute;
  top:50%;
  left:50%;
  transform: translate(-50%, -50%);
  font-size:12px;
  color:#fff;
  text-shadow: 0 1px 2px rgba(0,0,0,.8);
  pointer-events:none;
}

/* Delete btn (row) */
.dvw-del-btn{
  cursor:pointer;
  font-size:20px;
  text-shadow: 0 1px 3px rgba(0,0,0,.9);
}

.dvw-del-btn:hover{
  background-color: rgba(0,0,0,.3);
  border-radius:50px;
  padding:0 4px;
}

/* Make table horizontally scrollable on small screens */
#dvwTableWrap{
  overflow-x:auto;
  border-radius: 12px;
  box-shadow: 0 0 10px rgba(0,0,0,.6);
}

  </style>
</head>

<header class="video-header">
  <video autoplay muted loop playsinline>
    <source src="Video/Ocean-Seavo-Nautiq.mp4" type="video/mp4">
    

 </video>

  
</header>

    <div class="gradient-overgang"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


<body>

  <div id="sidePanel" class="hidden">
  <button>Information</button>
  <button>Documents</button>
  <button>Shared Content</button>
  <button>Settings</button>
  <button id="signOutBtn">Sign Out</button>

  <div id="bottomButtons">
    <button>🧮 Calculator</button>
    <button>📝 Notepad</button>
  </div>
</div>

<button id="togglePanelBtn" onclick="toggleSidePanel()">⫷</button>


  <div id="image-modal" style="display:none;">
  <div id="modal-overlay"></div>
  <img id="modal-image" src="">
</div>

<header>
  <h1 style="text-align: center; color:
   rgb(218, 215, 215);
    margin-top: 20px;
    font-size: 36px;
    font-weight: bold;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);" >
    Parts and tools</h1>
      
     
     <div>
     <a href="index.html" class="logo-link">
  <img src="images/Logo Seavo Nautiq.png" alt="Logo Seavo Nautiq" class="logo"> 
</a> 
</div>


<div>
</header>
  <input type="text" id="searchBox" placeholder="Search inventory..." oninput="searchInPage()">
</div>



<div class="category-slider-parts">
  <button class="arrow" onclick="scrollSlider(-100)">←</button>
  <div id="category-container" style="display: flex; overflow-x: auto; max-width: 50%; scroll-behavior: smooth;">
    <div id="categories" style="display: flex; gap: 8px;"></div>
  </div>
  <button class="arrow" onclick="scrollSlider(100)">→</button>
  <button class="add-category" onclick="addCategory()">+ Category</button>
</div>

<img src="images/Parts and tools.PNG" alt="parts and tools" class="parts-and-tools">






<div id="content"></div>


<button id="globalToggleButton" class="global-button" onclick="toggleGlobalView()">📋 Global Overview</button>

<div>


</button>
<button class="global-button" onclick="generatePDF()">📄 Generate PDF</button>

</div>

<!-- ========================================== -->
<!-- D/W/V (Fuel, Lube, Ballast) – EXTRA LINES -->
<!-- ========================================== -->
<section id="dvwSection">
  <h2>Fuel / Lube / Ballast — SG • Weight • Volume</h2>
  <div id="dvwTableWrap">
    <table class="dvw-table">
      <thead>
        <tr>
          <th>Product</th>
          <th>SG (—)</th>
          <th>Weight (kg)</th>
          <th>Volume (m³)</th>
          <th>Temp (°C)</th>
          <th>Level (max m³) + Gauge</th>
          <th>Comments</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody id="dvwTbody"></tbody>
    </table>
  </div>
  <button class="add-line" id="dvwAddBtn">+ Add line for D/W/V</button>
  <button class="add-line" id="dvwPdfBtn">📄 Export D/W/V PDF</button>
  <button class="add-line" id="dvwRecalcBtn">↻ Update calculations</button> <!-- NY -->
</section>



<script>
function searchInPage() {
  const term = document.getElementById("searchBox").value.trim().toLowerCase();
  removeHighlights();
  if (term === "") return;

  let firstMatch = null;

  document.querySelectorAll("td span").forEach(span => {
    const content = span.textContent.toLowerCase();
    if (content.includes(term)) {
      const index = content.indexOf(term);
      const original = span.textContent;
      const before = original.slice(0, index);
      const match = original.slice(index, index + term.length);
      const after = original.slice(index + term.length);
      span.innerHTML = `${before}<span class="highlight">${match}</span>${after}`;
      if (!firstMatch) firstMatch = span;
    }
  });

  document.querySelectorAll("input").forEach(input => {
    if (input.value.toLowerCase().includes(term)) {
      input.classList.add("highlight-input");
      if (!firstMatch) firstMatch = input;
    }
  });

  if (firstMatch) {
    setTimeout(() => {
      firstMatch.scrollIntoView({ behavior: "smooth", block: "center" });
    }, 100);
  }
}

function removeHighlights() {
  document.querySelectorAll("span .highlight").forEach(el => {
    const parent = el.parentNode;
    parent.replaceChild(document.createTextNode(el.textContent), el);
    parent.normalize();
  });

  document.querySelectorAll(".highlight-input").forEach(input => {
    input.classList.remove("highlight-input");
  });
}
</script>




<script>
let data = JSON.parse(localStorage.getItem("lagerDataV3")) || {};
let activeCategory = Object.keys(data)[0] || "Standard";

function save() {
  localStorage.setItem("lagerDataV3", JSON.stringify(data));
}

function scrollSlider(offset) {
  document.getElementById("category-container").scrollLeft += offset;
}



function updateCategories() {
  const container = document.getElementById("categories");
  container.innerHTML = "";

  Object.keys(data).forEach(name => {
    const wrapper = document.createElement("div");
    wrapper.className = "category-item";
    wrapper.style.display = "flex";
    wrapper.style.alignItems = "center";

    const btn = document.createElement("button");
    btn.className = "category-button";
    btn.textContent = name;
    if (name === activeCategory) btn.classList.add("active");
    btn.onclick = () => {
      activeCategory = name;
      showCategory();
      updateCategories();
    };

    const del = document.createElement("span");
    del.className = "delete-category";
    del.textContent = "🗑️";
    del.onclick = () => {
      if (confirm(`Do you want to delete the category "${name}"?`)) {
        delete data[name];
        activeCategory = Object.keys(data)[0] || null;
        save();
        updateCategories();
        showCategory();
      }
    };

    wrapper.appendChild(btn);
    wrapper.appendChild(del);
    container.appendChild(wrapper);
  });
}

function addCategory() {
  const name = prompt("New category:");
  if (name && !data[name]) {
    data[name] = [];
    activeCategory = name;
    save();
    updateCategories();
    showCategory();
  }
}
function showCategory() {
  const content = document.getElementById("content");
  content.innerHTML = "";

  if (!activeCategory || !data[activeCategory]) return;

  const table = document.createElement("table");
  table.innerHTML = `
    <thead>
      <tr>
        <th>Product/Type</th><th>Start Qty</th><th>Used</th><th>End Qty</th>
        <th>MIN🔔</th><th>Image<th>Comments</th><th>Order</th><th>Move</th><th>Delete</th>
      </tr>
    </thead>
    <tbody></tbody>
  `;

  const tbody = table.querySelector("tbody");

  data[activeCategory].forEach((row, i) => {
    const tr = document.createElement("tr");

    

    if (row.type === "header") {
      tr.className = "header-row";
      const td = document.createElement("td");
      td.colSpan = 9;
      const span = document.createElement("span");
      span.contentEditable = true;
      span.textContent = row.text || "Section / Header";
      span.oninput = () => {
        row.text = span.textContent;
        save();
      };
      td.appendChild(span);
      tr.appendChild(td);

      const del = document.createElement("td");
      del.style.textAlign = "center";
      del.innerHTML = `<span class="delete-button" onclick="deleteRow(${i})" style="cursor:pointer;">🗑️</span>`;

      tr.appendChild(del);
      tbody.appendChild(tr);
      return;
    }

    const fields = ['Parts and tools', 'start', 'used', 'end', 'min', 'image', 'comment', 'order'];
    const inputs = {};

    fields.forEach((key) => {
      const td = document.createElement("td");

    if (key === "image") {
  td.classList.add("cell-image");

  const fileInput = document.createElement("input");
  fileInput.type = "file";
  fileInput.accept = "image/*";
  fileInput.style.display = "none";
  const inputId = `file-${i}`;
  fileInput.id = inputId;

  const customButton = document.createElement("button");
  customButton.textContent = "📷 Upload";
  customButton.className = "upload-btn";
  customButton.onclick = (e) => {
    e.preventDefault();
    document.getElementById(inputId).click();
  };

  const preview = document.createElement("img");
  preview.style.maxWidth = "60px";
  preview.style.maxHeight = "50px";
  preview.style.display = row.image ? "block" : "none";
  if (row.image) preview.src = row.image;

  preview.style.cursor = "pointer";
  preview.onclick = () => {
  openImageModal(preview.src);
 };


  fileInput.onchange = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (event) {
        row.image = event.target.result;
        preview.src = row.image;
        preview.style.display = "block";
        save();
      };
      reader.readAsDataURL(file);
    }
  };

  const container = document.createElement("div");
  container.className = "image-upload-container";
  container.appendChild(customButton);
  container.appendChild(preview);

  td.appendChild(fileInput);
  td.appendChild(container);
  tr.appendChild(td);
  return;
}


      if (key === "Parts and tools") td.classList.add("cell-product");
      else if (key === "comment") td.classList.add("cell-comment");
      else if (key === "min") td.classList.add("cell-min");
      else if (key === "order") td.classList.add("cell-order");
      else td.classList.add("cell-small");


      const input = document.createElement("input");
      input.type = key === "Parts and tools" || key === "comment" ? "text" : "number";
      input.value = row[key] || "";
      input.style.width = "90%";
      input.style.padding = "4px";
      input.style.borderRadius = "5px";
      input.placeholder = key.charAt(0).toUpperCase() + key.slice(1);
      if (["Parts and tools", "comment", "start", "used", "end", "min", "order"].includes(key)) {
     input.classList.add("large-bold-input");
     }


      input.oninput = () => {
        row[key] = input.value;

        row.end = (parseFloat(row.start) || 0) - (parseFloat(row.used) || 0);
        inputs['end'].value = row.end;

        const endVal = parseFloat(row.end);
        const minVal = parseFloat(row.min);
        if (!isNaN(endVal) && !isNaN(minVal) && endVal <= minVal) {
          inputs['min'].classList.add("red-warning");
        } else {
          inputs['min'].classList.remove("red-warning");
        }

        save();
      };
      inputs[key] = input;
      td.appendChild(input);
      if (key === "Parts and tools") {
  const colorContainer = document.createElement("div");
  colorContainer.className = "color-buttons";

  const colors = ["limegreen", "gold", "mediumturquoise", "white"];
  colors.forEach(color => {
    const btn = document.createElement("button");
    btn.className = `color-btn ${color}`;
    btn.title = `Make ${color}`;
    btn.onclick = (e) => {
      e.preventDefault();
      row.productColor = color === "white" ? null : color;
      input.style.backgroundColor = row.productColor || "";
      save();
    };
    colorContainer.appendChild(btn);
  });

  td.appendChild(colorContainer);

  if (row.productColor) {
    input.style.backgroundColor = row.productColor || "";

  }
}
      tr.appendChild(td);
    });

    const tdMove = document.createElement("td");
    tdMove.classList.add("cell-move");
    tdMove.innerHTML = `
     <button onclick="moveRow(${i}, -1)">⬆️</button>
     <button onclick="moveRow(${i}, 1)">⬇️</button>
    `;

    const tdDel = document.createElement("td");
    tdDel.innerHTML = `<span class="delete-button" onclick="deleteRow(${i})">🗑️</span>`


    tr.appendChild(tdMove);  
    tr.appendChild(tdDel);
    tbody.appendChild(tr);
    
  });

  content.appendChild(table);

  const addLine = document.createElement("button");
  addLine.className = "add-line";
  addLine.textContent = "+ Add line";
  addLine.onclick = () => {
    data[activeCategory].push({
    type: "line", product: "", start: 0, used: 0,
    comment: "", min: 0, order: 0, end: 0, productColor: null
  });

    save();
    showCategory();
  };

  const addHeader = document.createElement("button");
  addHeader.className = "add-line";
  addHeader.textContent = "+ Add header/section";
  addHeader.onclick = () => {
    data[activeCategory].push({ type: "header", text: "New Header" });
    save();
    showCategory();
  };

  content.appendChild(addLine);
  content.appendChild(addHeader);
  searchInPage();

}

function deleteRow(index) {
  data[activeCategory].splice(index, 1);
  save();
  showCategory();
}

function moveRow(index, direction) {
  const list = data[activeCategory];
  const newIndex = index + direction;

  if (newIndex < 0 || newIndex >= list.length) return;

  const temp = list[index];
  list[index] = list[newIndex];
  list[newIndex] = temp;

  save();
  showCategory();
}


function showGlobalOverview() {
  const content = document.getElementById("content");
  content.innerHTML = "<h2>Global overview of the entire inventory</h2>";
  const table = document.createElement("table");
  table.innerHTML = `
    <thead>
      <tr><th>Category</th><th>Product</th><th>Start</th><th>Used</th><th>End</th><th>Min</th><th>Comment</th><th>Order</th></tr>
    </thead>
    <tbody></tbody>
  `;
  const tbody = table.querySelector("tbody");

  Object.entries(data).forEach(([category, rows]) => {
    rows.forEach(row => {
      if (row.type === "header") return;
      const tr = document.createElement("tr");
      const start = parseInt(row.start) || 0;
      const used = parseInt(row.used) || 0;
      const end = row.end ?? (start - used);
      const min = parseInt(row.min) || 0;

      const values = [
        category,
        row.product || "",
        start,
        used,
        end,
        min,
        row.comment || "",
        row.order || ""
      ];

      values.forEach((val, i) => {
        const td = document.createElement("td");
        td.textContent = val;
        if (i === 4 && end <= min) td.classList.add("red-warning");
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });
  });

  content.appendChild(table);
}

if (!data[activeCategory]) {
  data[activeCategory] = [];
  save();
}

let isGlobalView = false;

function toggleGlobalView() {
  const button = document.getElementById("globalToggleButton");

  if (!isGlobalView) {
    showGlobalOverview();
    button.textContent = "🔙 Back to Table";
  } else {
    showCategory();
    button.textContent = "📋 Global Overview";
  }

  isGlobalView = !isGlobalView;
}


updateCategories();
showCategory();

async function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p', 'mm', 'a4');

  
  const logoImg = new Image();
  logoImg.src = "images/Logo Seavo Nautiq.png";
  await new Promise(resolve => { logoImg.onload = resolve; });

  doc.addImage(logoImg, 'PNG', 10, 10, 60, 35); // (x, y, width, height)

  Headers.forEach((header, index) => {
    doc.setFontSize(16);
    doc.text(header, 10, 50 + (index * 10));
  });

  const content = document.getElementById("content");

  await html2canvas(content, {
    backgroundColor: "#ffffff"
  }).then(canvas => {
    const imgData = canvas.toDataURL('image/png');
    const imgProps = doc.getImageProperties(imgData);
    const pdfWidth = doc.internal.pageSize.getWidth() - 20;
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

    doc.addImage(imgData, 'PNG', 13, 35, pdfWidth, pdfHeight);
    doc.save("SeavoNautiq_Inventory.pdf");
  });
}

function openImageModal(src) {
  const modal = document.getElementById("image-modal");
  const modalImg = document.getElementById("modal-image");
  modalImg.src = src;
  modal.style.display = "flex";
}

document.getElementById("modal-overlay").onclick = () => {
  document.getElementById("image-modal").style.display = "none";
};

function toggleSidePanel() {
  const panel = document.getElementById("sidePanel");
  const toggleBtn = document.getElementById("togglePanelBtn");

  if (panel.classList.contains("hidden")) {
    panel.classList.remove("hidden");
    toggleBtn.style.right = "220px";
    toggleBtn.textContent = "⫸";
  } else {
    panel.classList.add("hidden");
    toggleBtn.style.right = "0px";
    toggleBtn.textContent = "⫷";
  }
}
</script>

<!-- ========================= -->
<!-- D/W/V: Logic & Persistence -->
<!-- ========================= -->
<script>
  // Egen lagring, påvirker ikke lagerDataV3
 let dvwData = JSON.parse(localStorage.getItem('dvwDataV1')) || [];

  function dvwSave(){ localStorage.setItem('dvwDataV1', JSON.stringify(dvwData)); }

  function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

  function percentColor(pct){
    if (isNaN(pct)) return '#40e0d0';
    if (pct <= 30) return '#f03747';
    if (pct <= 70) return '#ffd036';
    return '#36d131';
  }

  // Tillat , og ., og ikke ødelegg mellomtilstander som "0."
  function parseLocaleNumber(val){
    const s = String(val ?? '').trim().replace(/\s/g,'').replace(',', '.');
    if (s === '' || s === '-' || s === '.' || s === '-.') return NaN;
    return Number(s);
  }

  function renderDVWTable(){
    const tbody = document.getElementById('dvwTbody');
    tbody.innerHTML = '';

    dvwData.forEach((row, idx) => {
      const tr = document.createElement('tr');

      function makeInput(type, key, placeholder=''){
        const td = document.createElement('td');
        const input = document.createElement('input');
        input.type = type;
        input.placeholder = placeholder;
        input.value = row[key] ?? '';
        if (type === 'number'){
          input.step = 'any';
          input.inputMode = 'decimal';     // mobil: desimaltastatur
          input.pattern = '[0-9]*[.,]?[0-9]*';
        }
        input.classList.add('large-bold-input');

        input.oninput = () => {
          // Ikke overskriv brukerens pågående input
          const num = (type === 'number') ? parseLocaleNumber(input.value) : input.value;
          row[key] = (type === 'number' && isNaN(num)) ? '' : num;

          // Beregn og oppdater andre felt (ikke det aktuelle)
          recomputeRow(idx, key);

          const rr = dvwData[idx] || {};
          if (key !== 'sg'     && sg && sg.input) sg.input.value = rr.sg      ?? '';
          if (key !== 'weight' && w  && w.input)  w .input.value = rr.weight  ?? '';
          if (key !== 'volume' && v  && v.input)  v .input.value = rr.volume  ?? '';
          if (key !== 'temp'   && t  && t.input)  t .input.value = rr.temp    ?? '';

          updateGauge(idx, tr);
          dvwSave();
        };

        td.appendChild(input);
        return {td, input};
      }

      // Product
      const p = makeInput('text', 'product', 'Product');
      tr.appendChild(p.td);

      // SG (—)
      const sg = makeInput('number', 'sg', 'SG (—)');
      tr.appendChild(sg.td);

      // Weight (kg)
      const w = makeInput('number', 'weight', 'Weight (kg)');
      tr.appendChild(w.td);

      // Volume (m³)
      const v = makeInput('number', 'volume', 'Volume (m³)');
      tr.appendChild(v.td);

      // Temp (°C)
      const t = makeInput('number', 'temp', 'Temp (°C)');
      tr.appendChild(t.td);

      // Level (max) + gauge
      const tdLevel = document.createElement('td');
      const levelWrap = document.createElement('div');
      levelWrap.className = 'level-wrap';

      const levelRow = document.createElement('div');
      levelRow.className = 'level-input-row';

      const levelInput = document.createElement('input');
      levelInput.type = 'number';
      levelInput.step = 'any';
      levelInput.inputMode = 'decimal';
      levelInput.placeholder = 'Max m³';
      levelInput.value = row.levelMax ?? '';
      levelInput.classList.add('large-bold-input');
      levelInput.oninput = () => {
        const val = parseLocaleNumber(levelInput.value);
        row.levelMax = isNaN(val) ? '' : val;
        updateGauge(idx, tr);
        dvwSave();
      };

      levelRow.appendChild(levelInput);

      const bar = document.createElement('div');
      bar.className = 'level-bar';
      const fill = document.createElement('div');
      fill.className = 'level-fill';
      const label = document.createElement('div');
      label.className = 'level-label';
      label.textContent = '';

      bar.appendChild(fill);
      bar.appendChild(label);

      levelWrap.appendChild(levelRow);
      levelWrap.appendChild(bar);
      tdLevel.appendChild(levelWrap);
      tr.appendChild(tdLevel);

      // Comments
      const c = makeInput('text', 'comment', 'Comments');
      tr.appendChild(c.td);

      // Delete
      const tdDel = document.createElement('td');
      const del = document.createElement('span');
      del.className = 'dvw-del-btn';
      del.textContent = '🗑️';
      del.title = 'Delete line';
      del.onclick = () => {
        dvwData.splice(idx,1);
        dvwSave();
        renderDVWTable();
      };
      tdDel.appendChild(del);
      tr.appendChild(tdDel);

      tbody.appendChild(tr);

      // Init
      updateGauge(idx, tr);
    });
  }

  // Temperatur-korreksjon (enkel)
  const DVW_ALPHA = 0.0008; // pr °C

  function densityFromSGAtTemp(sg, temp){
    if (isNaN(sg)) return NaN;
    const d15 = sg * 1000; // kg/m³ @ ~15°C
    if (isNaN(temp)) return d15;
    return d15 / (1 + DVW_ALPHA * (temp - 15));
  }

  function sgFromDensityAtTemp(dT, temp){
    if (isNaN(dT)) return NaN;
    if (isNaN(temp)) return dT / 1000;
    const d15 = dT * (1 + DVW_ALPHA * (temp - 15));
    return d15 / 1000;
  }

  function roundSmart(val){
    if (Math.abs(val) >= 1000) return Math.round(val);
    if (Math.abs(val) >= 100)  return Math.round(val * 10) / 10;
    if (Math.abs(val) >= 10)   return Math.round(val * 100) / 100;
    return Math.round(val * 1000) / 1000;
  }
  function roundSG(val){ return Math.round(val * 1000) / 1000; }

  // Re-beregning som respekterer hvilket felt som endres
  function recomputeRow(idx, changedKey){
    const r = dvwData[idx] || {};
    const sg = parseLocaleNumber(r.sg);
    const w  = parseLocaleNumber(r.weight);
    const v  = parseLocaleNumber(r.volume);
    const t  = parseLocaleNumber(r.temp);

    const haveSG = !isNaN(sg);
    const haveW  = !isNaN(w);
    const haveV  = !isNaN(v);

    const rhoT = haveSG ? densityFromSGAtTemp(sg, t) : NaN;

    // Prioritet: beregn et annet felt enn det brukeren skriver i nå
    const setWeightFrom = () => {
      if (!isNaN(rhoT) && haveV){
        const wCalc = rhoT * v;
        r.weight = isFinite(wCalc) ? roundSmart(wCalc) : '';
      }
    };
    const setVolumeFrom = () => {
      if (!isNaN(rhoT) && haveW && rhoT !== 0){
        const vCalc = w / rhoT;
        r.volume = isFinite(vCalc) ? roundSmart(vCalc) : '';
      }
    };
    const setSGFrom = () => {
      if (haveW && haveV && v !== 0){
        const dT = w / v;
        const sgCalc = sgFromDensityAtTemp(dT, t);
        r.sg = isFinite(sgCalc) ? roundSG(sgCalc) : '';
      }
    };

    const known = (haveSG?1:0) + (haveW?1:0) + (haveV?1:0);

    if (known < 2) return;

    switch (changedKey){
      case 'sg':
      case 'temp':
        // Endrer SG/Temp → oppdater Weight (fra SG & Volume), ellers Volume (fra SG & Weight)
        if (haveSG && haveV) setWeightFrom();
        else if (haveSG && haveW) setVolumeFrom();
        else if (haveW && haveV) setSGFrom();
        break;

      case 'weight':
        // Endrer Weight → oppdater Volume (fra SG & Weight), ellers SG (fra W & V)
        if (haveSG && haveW) setVolumeFrom();
        else if (haveW && haveV) setSGFrom();
        else if (haveSG && haveV) setWeightFrom();
        break;

      case 'volume':
        // Endrer Volume → oppdater Weight (fra SG & Volume), ellers SG (fra W & V)
        if (haveSG && haveV) setWeightFrom();
        else if (haveW && haveV) setSGFrom();
        else if (haveSG && haveW) setVolumeFrom();
        break;

      default:
        // Generell fallback
        if (!haveW && haveSG && haveV) setWeightFrom();
        else if (!haveV && haveSG && haveW) setVolumeFrom();
        else if (!haveSG && haveW && haveV) setSGFrom();
    }
  }

  function updateGauge(idx, tr){
    const r = dvwData[idx] || {};
    const v = parseLocaleNumber(r.volume);
    const max = parseLocaleNumber(r.levelMax);
    const fill  = tr.querySelector('.level-fill');
    const label = tr.querySelector('.level-label');

    let pct = 0;
    if (!isNaN(v) && !isNaN(max) && max > 0){
      pct = clamp((v / max) * 100, 0, 100);
    }

    fill.style.width = pct + '%';
    fill.style.background = percentColor(pct);
    label.textContent = (isNaN(v) || isNaN(max) || max <= 0)
      ? '—'
      : `(${Math.round(pct)}%)`;
  }

  // Add line
  document.getElementById('dvwAddBtn').addEventListener('click', () => {
    dvwData.push({
      product: '',
      sg: '',
      weight: '',
      volume: '',
      temp: '',
      levelMax: '',
      comment: ''
    });
    dvwSave();
    renderDVWTable();
  });

  // PDF for D/W/V only
  document.getElementById('dvwPdfBtn').addEventListener('click', generateDVWPDF);

  async function generateDVWPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'mm', 'a4');

    // Logo (best effort)
    const logo = new Image();
    logo.src = "images/Logo Seavo Nautiq.png";
    await new Promise(res => { logo.onload = res; }).catch(()=>{});
    try { doc.addImage(logo, 'PNG', 10, 10, 50, 30); } catch(e){}

    doc.setFontSize(16);
    doc.text("D/W/V (Fuel • Lube • Ballast) — Overview", 10, 48);

    const wrap = document.getElementById('dvwTableWrap');

    const canvas = await html2canvas(wrap, { backgroundColor: "#ffffff", scale: 2 });
    const imgData = canvas.toDataURL('image/png');
    const imgProps = doc.getImageProperties(imgData);

    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();
    const marginX = 10;
    const topY = 55;

    const pdfW = pageWidth - marginX*2;
    const pdfH = (imgProps.height * pdfW) / imgProps.width;

    let y = topY;
    let remaining = pdfH;

    let sY = 0;
    const pageImgHeight = pageHeight - topY - 10;
    while (remaining > 0){
      const sliceH = Math.min(pageImgHeight, remaining);
      const sliceCanvas = document.createElement('canvas');
      const scale = pdfW / imgProps.width;
      sliceCanvas.width = imgProps.width;
      sliceCanvas.height = sliceH / scale;

      const ctx = sliceCanvas.getContext('2d');
      ctx.drawImage(canvas,
        0, sY / scale, imgProps.width, sliceCanvas.height,
        0, 0, imgProps.width, sliceCanvas.height);

      const sliceData = sliceCanvas.toDataURL('image/png');
      doc.addImage(sliceData, 'PNG', marginX, y, pdfW, sliceH);

      remaining -= sliceH;
      sY += sliceH;
      if (remaining > 0){
        doc.addPage();
        y = 20;
      }
    }

    doc.save('SeavoNautiq_DWV.pdf');
  }

  // Manuell oppdatering (↻-knappen)
  document.getElementById('dvwRecalcBtn').addEventListener('click', () => {
    dvwData.forEach((_, i) => recomputeRow(i, 'manual'));
    dvwSave();
    renderDVWTable();
  });

  // Init
  renderDVWTable();
</script>

</body>
</html>