<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory Management ‚Äì Seavo Nautiq</title>
  <style>
    body {
      background-color: #12315c;
      font-family: Arial, sans-serif;
      margin: 0;
      color: rgb(255, 255, 255);
    }

  

    .category-slider {
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(to right, #041425, #3b7fbe);
      padding: 16px;
      overflow-x: auto;
      margin-bottom: -30px;
      border-radius: 10px;
      width: 92%;
      margin-left: 58px;
    }

    .category-item {
      display: flex;
      align-items: center;
      margin: 0 6px;
    }

    .category-button, .add-category {
      padding: 10px 30px;
      background: linear-gradient(to right, #00b7ff, #326fa8);
      color: rgb(255, 255, 255);
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;  
    }

    .category-button.active {
      background: #9ccdfa;
      font-weight: bold;
    }
    
    .category-button:hover, .add-category:hover {
      background: #56bafd;
      color: white;
    }

    .delete-category {
      color: rgb(231, 19, 19);
      font-size:24px;
      margin-left: 20px;
      margin-right: 30px;
      cursor: pointer;
    }

    .arrow {
      font-size: 20px;
      font-weight: bold;
      padding: 5px 10px;
      background: transparent;
      color: rgb(255, 255, 255);
      border-radius: 6px;
      cursor: pointer;
      width: 60px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
    }

    .arrow:hover {
      background: linear-gradient(to right, #00b7ff, #326fa8);
      color: white;
    }

    #content {
      padding: 60px;
    }

    .logo {
      width: 200px;
      height: 40px;
      margin: 0 auto;
      margin-bottom: 0px;
      display: block;
      border-radius: 6px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
      margin-top: -40px;
      margin-left: 20px;
    }

    #searchBox {
      width: 200px;
      padding: 10px;
      border-radius: 6px;
      border:  1px solid #000000;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
      margin-left: 60px;
      margin-top: 50px;
      margin-bottom: -20px;
      font-weight: bold;
    }


    .container {
     display: flex;
     justify-content: flex-end; 
  }

    .container2 {
     display: flex;
     justify-content: flex-end; 
  }

    .info-badge {
     padding: 6px 18px;
     font-size: 14px;
     font-weight: bold;
     color: rgb(0, 0, 0);
     background: linear-gradient(to right, #ffffff, #ffda47);
     border-radius: 10px;
     margin-right: 58px;
     margin-top: 0px;
     box-shadow: #000000 0px 0px 2px;;
     margin-right: -160px;
  }

  .info-badge2 {
     padding: 8px 54px;
     font-size: 14px;
     font-weight: bold;
     color: rgb(0, 0, 0);
     background: linear-gradient(to right, #ffffff, #ee1919);
     border-radius: 10px;
     margin-right: 58px;
     margin-top: 42px;
     box-shadow: #000000 0px 0px 3px;
    margin-bottom: -42px;
    
  }


    table { 
      width: 100%;
      border-collapse: collapse;
      background-color: rgb(31, 59, 102);
      color: rgb(0, 0, 0);
      margin-bottom: 20px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.6);
    }


    .large-bold-input {
      font-weight: bold;
      font-size: 16px;
    }

    .cell-min {
      width: 45px;;
    }

    .cell-order {
      width: 40px;
    }

    .cell-move {
      width: 60px;
    }


    th, td {
      border: 1px solid #112036;
      padding: 5px;
      text-align: center;
      font-size: 18px;
    }

    th {
      background-color:  #13a2e4;
      color: rgb(0, 0, 0);
      border-radius: 5px;
    }

    td.min-col input {
      width: 60px;
    }

    .red-warning {
      background: linear-gradient(to right, #ffffff, #fc8701);
    }

    .add-line {
      padding: 8px 16px;
      margin: 5px 10px 20px 0;
      font-size: 15px;
      font-weight: bold;
      border-radius: 10px;
      background: linear-gradient(to right, #00b7ff, #326fa8);
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
    }

    .add-line:hover {
      background: linear-gradient(to right, #56bafd, #1b3863);
      color: white;
    }

    .color-btn.limegreen { background-color: #36d131; }   
    .color-btn.gold { background-color: #ffd036; }  
    .color-btn.mediumturquoise { background-color: #40e0d0; }
    .color-btn.white { background-color: #ffffff; }

    .color-btn {
      width: 18px;      
      height: 10px;
      border-radius: 30%;
      cursor: pointer;
    }

    .color-btn:hover {
      outline: 1px solid #fff;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.6);
    }


    .color-buttons {
      display: inline-flex;
      flex-direction: column;
      gap: 1px;
      margin-left: 2px;
      vertical-align: middle;
    }


    .header-row td {
      background: linear-gradient(to left, #12315c, #79acee);
      font-weight: bold;;
      text-align: left;
      border-radius: 5px;
      border-color: black;
    }

    .header-row td span {
      display: inline-block;
      width: 40%;
    }

    .delete-button {
      color: rgb(0, 0, 0);
      cursor: pointer;
      font-size: 24px;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);
    }

    .delete-button:hover {
      background-color: rgba(0, 0, 0, 0.3); 
      border-radius: 50px; 
      padding:0px 4px;
    }

    td:last-child {
      width: 50px; 
      background: linear-gradient(to right, #4e9bce, #1b3863);
    }


      button img {
      width: 40px;
      height: 40px;
      padding-left: 55px;
      margin-top: 20px;
    }


    .global-button {
      background: linear-gradient(to right, #00b7ff, #326fa8);
      color: rgb(255, 255, 255);
      padding: 20px 15px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 60px;
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
    }

    .global-button:hover {
      background: linear-gradient(to right, #56bafd, #1b3863);
      color: white;
    }

    .exportToExcel {
      background: linear-gradient(to right, #00b7ff, #326fa8);
      color: rgb(255, 255, 255);
      padding: 20px 20px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 60px;
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
    }

    .exportToExcel:hover {
      background: linear-gradient(to right, #56bafd, #1b3863);
      color: white;
    }

    .cell-product {
      width: 190px;
    }

    .cell-comment {
     width: 150px;
   }

   .cell-small {
   width: 80px;
   }

   

   .expiry-green {
  background: linear-gradient(to right, #fcfcfc, #39e99f);
  color: #000;
  font-weight: bold;
  box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
}

.expiry-yellow {
  background: linear-gradient(to right, #ffffff, #ffda47);
  color: #000;
  font-weight: bold;
  box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
}

.expiry-red {
  background: linear-gradient(to right, #ffffff, #d12e2e);
  color: #000000;
  font-weight: bold;
  box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
}


.activate-calculator {
  margin-left: 60px;
  margin-top: 20px;
  background: linear-gradient(to right, #00b7ff, #326fa8);
  color: rgb(0, 0, 0);
  padding: 6px 12px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.6);
}

.activate-calculator:hover {
  background: linear-gradient(to right, #56bafd, #1b3863);
  color: white;
}


.modal-innhold {
  position: absolute;
  left: 20%;
  top: 30%;
  transform: translate(-50%, -50%);
  background: linear-gradient(to right, #041425, #10395f);
  padding: 15px;
  width: 200px;
  border-radius: 18px;
  box-shadow: 0 0 12px #000;
  text-align: center;
}

.calculator-header {
  background: linear-gradient(to right, #104f68, #326fa8);
  color: rgb(255, 255, 255);
  padding: 5px;
  cursor: move;
  border-radius: 10px 10px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}



.lukk {
  font-weight: bold;
  font-size: 25px;
  cursor: pointer;
}




/* Brukes kun p√• PDF-versjon */
#pdf-content * {
  font-size: 20px;
  font-weight: bold;
  padding: 0px;
  border: 1px solid #5f5f5f; 
  color: black;
  background: transparent;
  box-shadow: none;
}


#notisblokk {
  position: absolute;
  display: none;
  top: 100px;
  left: 100px;
  width: 300px;
  height: 256px;
  background: linear-gradient(to left, #6ca9f8, #fcfcfc);
  border: 2px solid #333;
  border-radius: 20px;
  padding: 10px;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.7);
  font-family: Arial, sans-serif;
  z-index: 1000;
}

#notis-header {
  background: linear-gradient(to left, #fafafa, #01b1f7);
  padding: 5px;
  cursor: move;
  font-weight: bold;
  border-bottom: 1px solid #000000;
  border-radius: 15px 15px 0 0;
}

#notis-tekst {
  width: 100%;
  height: 180px;
  margin-top: 10px;
  border: none;
  background: transparent;
  resize: none;
  font-size: 18px;
}

.slett-knapp {
  margin-top: 5px;
  padding: 5px;
  width: 30%;
  margin-left: 200px;
  background-color: #af2d2d;
  color: white;
 
  border-radius: 5px;
  cursor: pointer;
}

.slett-knapp:hover {
  background-color: #fa1a1a;
}


  
  </style>
</head>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>




<body>

  <div id="notisblokk">
  <div id="notis-header">üìù Notepad</div>
  <textarea id="notis-tekst" placeholder="Write a note..."></textarea>
  <button class="slett-knapp" onclick="slettNotis()">Delete</button>
  
</div>


<!-- Modal container -->
<div id="calculatorModal" class="modal">

  
  <div class="modal-innhold" id="calculatorWindow">

    <div class="calculator-header" onmousedown="startDrag(event)">
      <h2 style="margin: 0; font-size: 15px;">Calculator</h2>
      <span class="lukk" onclick="closeCalculator()">√ó</span>
    </div>

    

    <input id="calc-display" type="text" readonly style="width: 90%; padding: 10px; font-size: 25px; text-align: right; margin-top: 10px;"><br><br>

    <!-- Kalkulatorknapper -->
    <div id="calc-buttons">
      <button onclick="appendCalc('7')">7</button>
      <button onclick="appendCalc('8')">8</button>
      <button onclick="appendCalc('9')">9</button>
      <button onclick="appendCalc('/')">√∑</button><br>
      <button onclick="appendCalc('4')">4</button>
      <button onclick="appendCalc('5')">5</button>
      <button onclick="appendCalc('6')">6</button>
      <button onclick="appendCalc('*')">√ó</button><br>
      <button onclick="appendCalc('1')">1</button>
      <button onclick="appendCalc('2')">2</button>
      <button onclick="appendCalc('3')">3</button>
      <button onclick="appendCalc('-')">‚àí</button><br>
      <button onclick="appendCalc('0')">0</button>
      <button onclick="appendCalc('.')">.</button>
      <button onclick="calculateResult()">=</button>
      <button onclick="appendCalc('+')">+</button><br>
      <button onclick="appendCalc('%')">%</button>
      <button onclick="deleteLast()" style="width: 30%;">DEL</button><br>
      <button onclick="clearCalc()" style="width: 90%">C</button>
      <style>
        #calc-buttons button {
          width: 36px;
          height: 30px;
          font-size: 24px;
          margin: 3px;
          background: linear-gradient(to right, #00b7ff, #326fa8);
          color: rgb(255, 255, 255);
          border: none;
          border-radius: 6px;
          cursor: pointer;
        }

        #calc-buttons button:hover {
          background: linear-gradient(to right, #6bb5f1, #71b1cf);
        }
      </style>
    </div>

  </div>
</div>

</div>



<header>
  <h1 style="text-align: center; color:
   rgb(218, 215, 215);
    margin-top: 70px;
    font-size: 36px;
    font-weight: bold;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);" >
   
    <img src="images/Seavo nautiq logo.png" alt="logo" class="logo">
  Provisions</h1>



</header>



<div class="category-slider">
  <button class="arrow" onclick="scrollSlider(-100)">‚Üê</button>
  <div id="category-container" style="display: flex; overflow-x: auto; max-width: 50%; scroll-behavior: smooth;">
    <div id="categories" style="display: flex; gap: 8px;"></div>
  </div>
  <button class="arrow" onclick="scrollSlider(100)">‚Üí</button>
  <button class="add-category" onclick="addCategory()">+ Category</button>
</div>
 


  <input type="text" id="searchBox" placeholder="Search inventory..." oninput="searchInPage()">

 <div>
  <button class="activate-calculator" onclick="document.getElementById('calculatorModal').style.display='block'">üßÆ Calculator</button>
  </div>

 <button class="activate-calculator" onclick="toggleNotisblokk()">üìù Notepad</button>


<div class="container">
  <span class="info-badge">Expires in 10 days </span>
  <span class="info-badge2">Expired </span>
</div>


<style>
.highlight {
  background-color: rgb(240, 138, 42);
  font-weight: bold;
}

.highlight-input {
  background-color: yellow;
  font-weight: bold;
}
</style>


</div>



<div id="content"></div>


<button class="global-button" onclick="showGlobalOverview()">üìã Global Overview</button>

<div>


</button>
<button class="global-button" onclick="generatePDF()">üìÑ Generate PDF</button>
<div>
<button class="exportToExcel" onclick="exportToExcel()">üìÑ Export to Excel</button>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

</div>

<div id="pdf-content" style="display: none;"></div>



<script>
function searchInPage() {
  const term = document.getElementById("searchBox").value.trim().toLowerCase();
  removeHighlights();
  if (term === "") return;

  let firstMatch = null;

  // 1. S√∏k i headers (span-elementer)
  document.querySelectorAll("td span").forEach(span => {
    const content = span.textContent.toLowerCase();
    if (content.includes(term)) {
      const index = content.indexOf(term);
      const original = span.textContent;
      const before = original.slice(0, index);
      const match = original.slice(index, index + term.length);
      const after = original.slice(index + term.length);
      span.innerHTML = `${before}<span class="highlight">${match}</span>${after}`;
      if (!firstMatch) firstMatch = span;
    }
  });

  // 2. S√∏k i input-feltene
  document.querySelectorAll("input").forEach(input => {
    if (input.value.toLowerCase().includes(term)) {
      input.classList.add("highlight-input");
      if (!firstMatch) firstMatch = input;
    }
  });

  // Scroll til f√∏rste treff
  if (firstMatch) {
    setTimeout(() => {
      firstMatch.scrollIntoView({ behavior: "smooth", block: "center" });
    }, 100); // vent litt s√• tabellen rekker √• tegne seg
  }
}

function removeHighlights() {
  // Fjern <span class="highlight"> fra header
  document.querySelectorAll("span .highlight").forEach(el => {
    const parent = el.parentNode;
    parent.replaceChild(document.createTextNode(el.textContent), el);
    parent.normalize();
  });

  // Fjern gul markering fra input
  document.querySelectorAll(".highlight-input").forEach(input => {
    input.classList.remove("highlight-input");
  });
}


</script>




<script>
let data = JSON.parse(localStorage.getItem("lagerDataV3")) || {};
let activeCategory = Object.keys(data)[0] || "Standard";

function save() {
  localStorage.setItem("lagerDataV3", JSON.stringify(data));
}

function scrollSlider(offset) {
  document.getElementById("category-container").scrollLeft += offset;
}

function updateCategories() {
  const container = document.getElementById("categories");
  container.innerHTML = "";

  Object.keys(data).forEach(name => {
    const wrapper = document.createElement("div");
    wrapper.className = "category-item";
    wrapper.style.display = "flex";
    wrapper.style.alignItems = "center";

    const btn = document.createElement("button");
    btn.className = "category-button";
    btn.textContent = name;
    if (name === activeCategory) btn.classList.add("active");
    btn.onclick = () => {
      activeCategory = name;
      showCategory();
      updateCategories();
    };

    const del = document.createElement("span");
    del.className = "delete-category";
    del.textContent = "üóëÔ∏è";
    del.onclick = () => {
      if (confirm(`Do you want to delete the category "${name}"?`)) {
        delete data[name];
        activeCategory = Object.keys(data)[0] || null;
        save();
        updateCategories();
        showCategory();
      }
    };

    wrapper.appendChild(btn);
    wrapper.appendChild(del);
    container.appendChild(wrapper);
  });
}

function addCategory() {
  const name = prompt("New category:");
  if (name && !data[name]) {
    data[name] = [];
    activeCategory = name;
    save();
    updateCategories();
    showCategory();
  }
}
function showCategory() {
  const content = document.getElementById("content");
  content.innerHTML = "";

  if (!activeCategory || !data[activeCategory]) return;

  const table = document.createElement("table");
  table.innerHTML = `
    <thead>
      <tr>
        <th>Product/Type</th><th>Start Qty</th><th>Used</th><th>End Qty</th>
        <th>MINüîî</th><th>Expiry Date</th><th>Comments</th>
        <th>Order</th><th>Move</th><th>Delete</th>
      </tr>
    </thead>
    <tbody></tbody>
  `;

  const tbody = table.querySelector("tbody");

  data[activeCategory].forEach((row, i) => {
    const tr = document.createElement("tr");

    

    if (row.type === "header") {
      tr.className = "header-row";
      const td = document.createElement("td");
      td.colSpan = 8;
      const span = document.createElement("span");
      span.contentEditable = true;
      span.textContent = row.text || "Section / Header";
      span.oninput = () => {
        row.text = span.textContent;
        save();
      };
      td.appendChild(span);
      tr.appendChild(td);

      const del = document.createElement("td");
      del.style.textAlign = "center";
      del.innerHTML = `<span class="delete-button" onclick="deleteRow(${i})" style="cursor:pointer;">üóëÔ∏è</span>`;
     

      tr.appendChild(del);
      tbody.appendChild(tr);
      return;
    }

    const fields = ['provisions', 'start', 'used', 'end', 'min', 'expiry', 'comment', 'order'];
    const inputs = {};

    fields.forEach((key) => {
      const td = document.createElement("td");
      
      if (key === "provisions") td.classList.add("cell-product");
      
      else if (key === "comment") td.classList.add("cell-comment");
      else if (key === "min") td.classList.add("cell-min");
      else if (key === "order") td.classList.add("cell-order");
      else td.classList.add("cell-small");


      const input = document.createElement("input");
      input.type = key === "provisions" || key === "comment" ? "text" : "number";
      input.value = row[key] || "";
      input.style.width = "90%";
      input.style.padding = "4px";
      input.style.borderRadius = "5px";
      input.placeholder = key.charAt(0).toUpperCase() + key.slice(1);
      if (["provisions", "comment", "start", "used", "end", "min", "order"].includes(key)) {
     input.classList.add("large-bold-input");
     }


      input.oninput = () => {
        row[key] = input.value;

        row.end = (parseFloat(row.start) || 0) - (parseFloat(row.used) || 0);
        inputs['end'].value = row.end;

        const endVal = parseFloat(row.end);
        const minVal = parseFloat(row.min);
        if (!isNaN(endVal) && !isNaN(minVal) && endVal <= minVal) {
          inputs['min'].classList.add("red-warning");
        } else {
          inputs['min'].classList.remove("red-warning");
        }

        save();
      };
      inputs[key] = input;
      td.appendChild(input);
      if (key === "provisions") {
  // 1. Lag fargeknappene
  const colorContainer = document.createElement("div");
  colorContainer.className = "color-buttons";

  const colors = ["limegreen", "gold", "mediumturquoise", "white"];
  colors.forEach(color => {
    const btn = document.createElement("button");
    btn.className = `color-btn ${color}`;
    btn.title = `Make ${color}`;
    btn.onclick = (e) => {
      e.preventDefault();
      row.productColor = color === "white" ? null : color;
      input.style.backgroundColor = row.productColor || "";
      save();
    };
    colorContainer.appendChild(btn);
  });

  td.appendChild(colorContainer);

  // 2. Bruk lagret farge n√•r cellen bygges
  if (row.productColor) {
    input.style.backgroundColor = row.productColor || "";

  }
}
      tr.appendChild(td);

   if (key === "expiry") {
  input.type = "date";

  const updateExpiryClass = () => {
    input.classList.remove("expiry-green", "expiry-yellow", "expiry-red");

    if (!input.value) return;

    const today = new Date();
    const expiryDate = new Date(input.value);
    const diffTime = expiryDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if (diffDays < 0) {
      input.classList.add("expiry-red");
    } else if (diffDays <= 10) {
      input.classList.add("expiry-yellow");
    } else {
      input.classList.add("expiry-green");
    }
  };

  input.oninput = () => {
    row[key] = input.value;
    updateExpiryClass();
    save();
  };

  // Sett farge ved lasting
   updateExpiryClass();
  }



    });

    const tdMove = document.createElement("td");
    tdMove.classList.add("cell-move");
    tdMove.innerHTML = `
     <button onclick="moveRow(${i}, -1)">‚¨ÜÔ∏è</button>
     <button onclick="moveRow(${i}, 1)">‚¨áÔ∏è</button>
    `;

    const tdDel = document.createElement("td");
    tdDel.innerHTML = `<span class="delete-button" onclick="deleteRow(${i})">üóëÔ∏è</span>`


    tr.appendChild(tdMove);  
    tr.appendChild(tdDel);
    tbody.appendChild(tr);
    
  });

  content.appendChild(table);

  const addLine = document.createElement("button");
  addLine.className = "add-line";
  addLine.textContent = "+ Add line";
  addLine.onclick = () => {
    data[activeCategory].push({
    type: "line", product: "", start: 0, used: 0,
    comment: "", min: 0, expiry: "", order: 0, end: 0, productColor: null
  });

    save();
    showCategory();
  };

  const addHeader = document.createElement("button");
  addHeader.className = "add-line";
  addHeader.textContent = "+ Add header/section";
  addHeader.onclick = () => {
    data[activeCategory].push({ type: "header", text: "New Header" });
    save();
    showCategory();
  };

  content.appendChild(addLine);
  content.appendChild(addHeader);
  searchInPage(); // kj√∏r s√∏ket igjen etter innhold er bygd opp

}

function deleteRow(index) {
  data[activeCategory].splice(index, 1);
  save();
  showCategory();
}

function moveRow(index, direction) {
  const list = data[activeCategory];
  const newIndex = index + direction;

  // Hindrer at den flyttes utenfor grensene
  if (newIndex < 0 || newIndex >= list.length) return;

  // Bytter plass p√• radene
  const temp = list[index];
  list[index] = list[newIndex];
  list[newIndex] = temp;

  save();
  showCategory(); // Tegner tabellen p√• nytt
}


function showGlobalOverview() {
  const content = document.getElementById("content");
  content.innerHTML = "<h2>Global overview of the entire provisions</h2>";
  const table = document.createElement("table");
  table.innerHTML = `

    <thead>
      <tr><th>Category</th><th>Product</th><th>Start</th><th>Used</th><th>End</th><th>Min</th><th>Comment</th><th>Order</th></tr>
    </thead>
    <tbody></tbody>
  `;
  const tbody = table.querySelector("tbody");

  Object.entries(data).forEach(([category, rows]) => {
    rows.forEach(row => {
      if (row.type === "header") return;
      const tr = document.createElement("tr");
      const start = parseInt(row.start) || 0;
      const used = parseInt(row.used) || 0;
      const end = row.end ?? (start - used);
      const min = parseInt(row.min) || 0;

      const values = [
        category,
        row.product || "",
        start,
        used,
        end,
        min,
        row.comment || "",
        row.order || ""
      ];

      values.forEach((val, i) => {
        const td = document.createElement("td");
        td.textContent = val;
        if (i === 4 && end <= min) td.classList.add("red-warning");
        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });
  });

  content.appendChild(table);
}

if (!data[activeCategory]) {
  data[activeCategory] = [];
  save();
}
updateCategories();
showCategory();

async function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p', 'mm', 'a4');

  const logoImg = new Image();
  logoImg.src = "images/Logo Seavo Nautiq.png";
  await new Promise(resolve => { logoImg.onload = resolve; });

  doc.addImage(logoImg, 'PNG', 10, 10, 60, 35); // Logo √∏verst

  // KLONE OG RENS INNHOLDET
  const original = document.getElementById("content");
  const clone = original.cloneNode(true);

  // Fjern bakgrunnsfarger og juster utseende
  clone.querySelectorAll("*").forEach(el => {
    el.style.backgroundColor = "transparent";
    el.style.color = "black";
    el.style.boxShadow = "none";
    el.style.borderColor = "#333"; // valgfritt: vis rammer
  });

  const pdfContainer = document.getElementById("pdf-content");
  pdfContainer.innerHTML = "";
  pdfContainer.appendChild(clone);
  pdfContainer.style.display = "block";

  await html2canvas(pdfContainer, {
    backgroundColor: "#ffffff",
    scale: 2 // forbedrer kvalitet
  }).then(canvas => {
    const imgData = canvas.toDataURL('image/png');
    const pdfWidth = doc.internal.pageSize.getWidth() - 20;
    const imgProps = doc.getImageProperties(imgData);
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

    doc.addImage(imgData, 'PNG', 13, 50, pdfWidth, pdfHeight);
    doc.save("SeavoNautiq_Inventory.pdf");
  });

  
  pdfContainer.style.display = "none";
}

updateCategories();
showCategory();

function exportToExcel() {
  const workbook = XLSX.utils.book_new();
  const sheetData = [];

  // Header row
  sheetData.push(["Category", "Product", "Start Qty", "Used Qty", "End Qty", "Min Qty", "Expiry Date", "Comments", "Order"]);

  Object.entries(data).forEach(([category, rows]) => {
    rows.forEach(row => {
      if (row.type === "header") return;
      const start = parseInt(row.start) || 0;
      const used = parseInt(row.used) || 0;
      const end = row.end ?? (start - used);
      const min = parseInt(row.min) || 0;

      sheetData.push([
        category,
        row.product || "",
        start,
        used,
        end,
        min,
        row.expiry || "",
        row.comment || "",
        row.order || ""
      ]);
    });
  });

  const worksheet = XLSX.utils.aoa_to_sheet(sheetData);
  XLSX.utils.book_append_sheet(workbook, worksheet, "Inventory");
  
  XLSX.writeFile(workbook, "SeavoNautiq_Inventory.xlsx");
}




function appendCalc(value) {
  const display = document.getElementById("calc-display");
  display.value += value;
}

function clearCalc() {
  document.getElementById("calc-display").value = "";
}

function calculateResult() {
  try {
    const display = document.getElementById("calc-display");
    let expression = display.value.replace(/%/g, "/100");
    display.value = eval(expression);
  } catch {
    alert("Invalid expression");
  }
}


function deleteLast() {
  const display = document.getElementById("calc-display");
  display.value = display.value.slice(0, -1);
}

function toggleSign() {
  const display = document.getElementById("calc-display");
  if (display.value) {
    if (display.value.startsWith('-')) {
      display.value = display.value.substring(1);
    } else {
      display.value = '-' + display.value;
    }
  }
}


let isDragging = false;
let offsetX, offsetY;

function startDrag(e) {
  const target = e.target.closest(".calculator-header");
  if (!target) return;

  isDragging = true;
  const calcWindow = document.getElementById("calculatorWindow");
  offsetX = e.clientX - calcWindow.offsetLeft;
  offsetY = e.clientY - calcWindow.offsetTop;

  document.onmousemove = drag;
  document.onmouseup = stopDrag;
}

function drag(e) {
  if (!isDragging) return;
  const calcWindow = document.getElementById("calculatorWindow");
  calcWindow.style.left = `${e.clientX - offsetX}px`;
  calcWindow.style.top = `${e.clientY - offsetY}px`;
}

function stopDrag() {
  isDragging = false;
  document.onmousemove = null;
  document.onmouseup = null;
}

function closeCalculator() {
  document.getElementById("calculatorModal").style.display = "none";
}


const notis = document.getElementById("notisblokk");
const header = document.getElementById("notis-header");
const tekstfelt = document.getElementById("notis-tekst");

// Last lagret tekst og posisjon
window.addEventListener("load", () => {
  const lagretTekst = localStorage.getItem("notisTekst");
  const posX = localStorage.getItem("notisPosX");
  const posY = localStorage.getItem("notisPosY");

  if (lagretTekst) tekstfelt.value = lagretTekst;
  if (posX && posY) {
    notis.style.left = posX + "px";
    notis.style.top = posY + "px";
  }
});

// Toggle notisblokk
function toggleNotisblokk() {
  notis.style.display = (notis.style.display === "block") ? "none" : "block";
}

// Slett notat
function slettNotis() {
  tekstfelt.value = "";
  notis.style.left = "100px";
  notis.style.top = "100px";
  localStorage.removeItem("notisTekst");
  localStorage.removeItem("notisPosX");
  localStorage.removeItem("notisPosY");
}

// Lagre tekst automatisk
tekstfelt.addEventListener("input", () => {
  localStorage.setItem("notisTekst", tekstfelt.value);
});

// Dra-funksjon med posisjonslagring
let isDraggingNotis = false, offsetXNotis = 0, offsetYNotis = 0;

header.addEventListener("mousedown", (e) => {
  isDraggingNotis = true;
  offsetXNotis = e.clientX - notis.offsetLeft;
  offsetYNotis = e.clientY - notis.offsetTop;
});

document.addEventListener("mousemove", (e) => {
  if (isDraggingNotis) {
    notis.style.left = `${e.clientX - offsetXNotis}px`;
    notis.style.top = `${e.clientY - offsetYNotis}px`;
  }
});

document.addEventListener("mouseup", () => {
  if (isDraggingNotis) {
    localStorage.setItem("notisPosX", parseInt(notis.style.left));
    localStorage.setItem("notisPosY", parseInt(notis.style.top));
  }
  isDraggingNotis = false;


});




</script>
</body>
</html>
